<div class="flex flex-col gap-4 justify-center ja-bg-white p-4 rounded-2xl">
  <h1 class="ja-big-title inline"> Grades Statuses </h1>

  @if (errorMessage) {
  <span class="alert alert-danger">{{ errorMessage }}</span>
  }
  @if (successMessage) {
  <span class="alert alert-success">{{ successMessage }}</span>
  }
  @if (isLoading) {
  <app-loading-container> </app-loading-container>
  } @else {
  <div class="flex justify-between gap-x-4 flex-wrap md:flex-nowrap">

    <mat-form-field appearance="outline" class="w-full">
      <mat-label>Find</mat-label>
      <input matInput (keyup)="applyFilter($event)" #input>
    </mat-form-field>

    <div class="flex gap-x-4 items-center">
      <div class="flex gap-x-2">
        <label class="text-tertiary font-medium">Period</label>
        <mat-form-field appearance="outline" class="simple no-hint">
          <mat-select [compareWith]="value_select" [(ngModel)]="selectedGradesPeriodId"
            (selectionChange)="setSelectedGradesPeriodId(_selectedGradesPeriodId.value)"
            #_selectedGradesPeriodId>
            @for (gradesProcessingPeriod of gradesProcessingPeriods; track gradesProcessingPeriod) {
            <mat-option class="simple"
              [value]="gradesProcessingPeriod.id">{{gradesProcessingPeriod.descriptor}}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
      @if(gradesProcessingPeriods.includes(selectedGradesPeriodId)){
      {{selectedGradesPeriodId}}
      <div class="flex gap-x-2">
        <label class="text-tertiary font-medium">Entry Start</label>
        <div class="text-primary">{{entryStartDate | date}}</div>
      </div>
      <div class="flex gap-x-2">
        <label class="text-tertiary font-medium">Due Date</label>
        <div class="text-primary">{{entryEndDate | date}}</div>
      </div>
      }

    </div>
  </div>

  <div>
    <table mat-table [dataSource]="dataSource" matSort>

      <ng-container matColumnDef="index">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> </th>
        <td mat-cell *matCellDef="let row; let i = index"> {{ (paginator?.pageSize * paginator?.pageIndex) + (i + 1) }}
        </td>
      </ng-container>

      <ng-container matColumnDef="Profile">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> </th>
        <td mat-cell *matCellDef="let row" (click)="gotoStudent(row.studentGUId, row.studentName)">
          <hugeicons-icon [icon]="User02FreeIcons" [size]="24" color="#187ca8" [strokeWidth]="1.5"></hugeicons-icon>
        </td>
      </ng-container>

      <ng-container matColumnDef="studentName">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Student </th>
        <td mat-cell *matCellDef="let row" (click)="editGradeEntryDetails(row.studentGUId, row.studentName)">
          {{row.studentName}} </td>
      </ng-container>

      <ng-container matColumnDef="gradesTurnedInDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Grades Entered </th>
        <td mat-cell *matCellDef="let row">
          <div class="flex gap-x-2 items-center"
            [ngClass]="!isViewLinkHidden(row.gradesTurnedInDate) ? 'text-green-500' : 'text-red-500'">
            @if(!isViewLinkHidden(row.gradesTurnedInDate)) {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#22c55e"
              fill="none">
              <path d="M5 14L8.5 17.5L19 6.5" stroke="#22c55e" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round"></path>
            </svg>
            } @else {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#ef4444"
              fill="none">
              <path d="M18 6L6.00081 17.9992M17.9992 18L6 6.00085" stroke="#ef4444" stroke-width="1.5"
                stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            }
            <div class="flex flex-col">
              <span class="text-xs">{{ row.gradePointAvg }}</span>
              <span class="text-xxs">
                @if(!isViewLinkHidden(row.gradesTurnedInDate) ){
                {{row.gradesTurnedInDate | date}}
                }
              </span>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="imageSubmittedDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Grades Uploaded </th>
        <td mat-cell *matCellDef="let row">
          <div class="flex gap-x-2 items-center p-1 rounded-md"
            [ngClass]="!isViewLinkHidden(row.imageSubmittedDate) ? 'text-green-500' : 'text-red-500'">
            @if(!isViewLinkHidden(row.imageSubmittedDate)) {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#22c55e"
              fill="none">
              <path d="M5 14L8.5 17.5L19 6.5" stroke="#22c55e" stroke-width="1.5" stroke-linecap="round"
                stroke-linejoin="round"></path>
            </svg>
            } @else {
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24" color="#ef4444"
              fill="none">
              <path d="M18 6L6.00081 17.9992M17.9992 18L6 6.00085" stroke="#ef4444" stroke-width="1.5"
                stroke-linecap="round" stroke-linejoin="round"></path>
            </svg>
            }
            <div class="flex flex-col">
              <span class="text-xs">Grades</span>
              <span class="text-xxs">
                @if(!isViewLinkHidden(row.imageSubmittedDate) ){
                {{row.imageSubmittedDate | date}}
                }
              </span>
            </div>
          </div>
        </td>
      </ng-container>

      <ng-container matColumnDef="open">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Evidence </th>
        <td mat-cell *matCellDef="let row">
          @if(!(isViewLinkHidden(row.imageSubmittedDate) && isViewLinkHidden(row.gradesTurnedInDate))) {
          <button type="button" (click)="open_documentation_dialog(row)" class="ja-btn ja-btn-primary">View Evidence</button>
          }
        </td>
      </ng-container>

      <ng-container matColumnDef="confirmedDate">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Confirmed Date </th>
        <td mat-cell *matCellDef="let row">
          @if(!this.isViewLinkHidden(row.confirmedDate)){
          {{ row.confirmedDate | date }}
          }
        </td>
      </ng-container>
      
      <ng-container matColumnDef="gradesTurnedInStatus">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> Turned-In Status </th>
        <td mat-cell *matCellDef="let row">
          {{ row.gradesTurnedInStatus }}
        </td>
      </ng-container>
      
      <ng-container matColumnDef="gradePointAvgStatus">
        <th mat-header-cell *matHeaderCellDef mat-sort-header> GPA Status </th>
        <td mat-cell *matCellDef="let row">
          {{ row.gradePointAvgStatus }}
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell m-auto p-4" [attr.colspan]="displayedColumns.length">
          @if(input.value.length && dataSource.data.length > 0){
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="-5 -5 34 34" width="64" height="64" color="#13538a"
            class="m-auto rounded-full bg-secondary/10" fill="none">
            <path d="M17 17L21 21" stroke="#13538a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11C3 15.4183 6.58172 19 11 19C15.4183 19 19 15.4183 19 11Z"
              stroke="#13538a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path d="M8 8L11 11M11 11L14 14M11 11L14 8M11 11L8 14" stroke="#13538a" stroke-width="1.5"
              stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          <div class="text-secondary text-center font-medium m-auto">No data matching the filter "{{input.value}}"</div>
          } @else {
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="-5 -5 34 34" width="64" height="64" color="#13538a"
            class="m-auto rounded-full bg-secondary/10" fill="none">
            <path
              d="M10.9985 7.99927C15.4168 7.99927 18.9985 6.65612 18.9985 4.99927C18.9985 3.34241 15.4168 1.99927 10.9985 1.99927C6.58026 1.99927 2.99854 3.34241 2.99854 4.99927C2.99854 6.65612 6.58026 7.99927 10.9985 7.99927Z"
              stroke="#13538a" stroke-width="1.5"></path>
            <path d="M5.99854 10.8411C6.60012 11.0219 7.27288 11.1709 7.99854 11.281" stroke="#13538a"
              stroke-width="1.5" stroke-linecap="round"></path>
            <path d="M10.9985 14.9993C6.58025 14.9993 2.99854 13.6562 2.99854 11.9993" stroke="#13538a"
              stroke-width="1.5" stroke-linecap="round"></path>
            <path d="M5.99854 17.8411C6.60012 18.0219 7.27288 18.1709 7.99854 18.281" stroke="#13538a"
              stroke-width="1.5" stroke-linecap="round"></path>
            <path d="M10.9985 21.9993C6.58025 21.9993 2.99854 20.6562 2.99854 18.9993V4.99927M18.9985 4.99927V10.4993"
              stroke="#13538a" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path>
            <path
              d="M17.5 19.525H17.5081M17.5088 17.5V15.475M22 17.5C22 19.9853 19.9853 22 17.5 22C15.0147 22 13 19.9853 13 17.5C13 15.0147 15.0147 13 17.5 13C19.9853 13 22 15.0147 22 17.5Z"
              stroke="#13538a" stroke-width="1.5" stroke-linecap="round"></path>

          </svg>
          <div class="text-secondary font-medium m-auto text-center">No data has been loaded.</div>
          }
        </td>
      </tr>
    </table>

    <mat-paginator [pageSizeOptions]="[10, 25, 100]" aria-label="Select page of users"></mat-paginator>
  </div>
  }
</div>


<ng-template #documentation>
  @for(evidence of paginated_items; track evidence){
  <h2 mat-dialog-title>
    <div class="ja-big-title">Documentation | {{evidence.studentName}}</div>
  </h2>
  <mat-dialog-content>
    <div class="flex flex-col md:flex-row gap-4 md:justify-center md:items-start justify-start items-center">
      <div class="flex flex-col max-w-[30rem] max-h-[30rem]">
        <div class="ja-title">GPA</div>
        @if(!isViewLinkHidden(evidence.gradesTurnedInDate)) {
        <span class="text-2xl font-medium" [ngStyle]="{color: color(evidence.gradePointAvg)}">{{evidence.gradePointAvg}}</span>
        } @else {
        <div class="bg-red-100 rounded-2xl p-4 text-red-500 flex flex-col items-center max-w-96 text-wrap text-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" color="#ef4444"
            fill="none">
            <path
              d="M4 11.0004L4 14.5446C4 17.7896 4 19.4121 4.88607 20.5111C5.06508 20.7331 5.26731 20.9354 5.48933 21.1144C6.58831 22.0004 8.21082 22.0004 11.4558 22.0004C12.1614 22.0004 12.5141 22.0004 12.8372 21.8864C12.9044 21.8627 12.9702 21.8354 13.0345 21.8047C13.3436 21.6569 13.593 21.4074 14.0919 20.9085L18.8284 16.172C19.4065 15.5939 19.6955 15.3049 19.8478 14.9374C20 14.5698 20 14.1611 20 13.3436V10.0004C20 6.22919 20 4.34358 18.8284 3.172C17.7693 2.11284 16.1265 2.01122 13.0345 2.00146M13 21.5004V21.0004C13 18.172 13 16.7578 13.8787 15.8791C14.7574 15.0004 16.1716 15.0004 19 15.0004H19.5"
              stroke="#ef4444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M9.97487 7.97438C10.6082 7.34101 11 6.46601 11 5.49951C11 3.56651 9.433 1.99951 7.5 1.99951C6.5335 1.99951 5.6585 2.39126 5.02513 3.02464M9.97487 7.97438C9.3415 8.60776 8.4665 8.99951 7.5 8.99951C5.567 8.99951 4 7.43251 4 5.49951C4 4.53301 4.39175 3.65801 5.02513 3.02464M9.97487 7.97438L5.02513 3.02464"
              stroke="#ef4444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          El estudiante aún no ha subido su promedio.
        </div>
        }
      </div>
      <div class="flex flex-col">
        <div class="ja-title">Grades</div>
        @if(!isViewLinkHidden(evidence.imageSubmittedDate)) {
        <img
          src="https://jawebapi.jovenesadelante.org/static/StudentGradesReports/{{evidence.academicTermId}}/{{evidence.studentGUId | uppercase }}.png"
          alt="" class="w-full max-w-[30rem] max-h-[30rem] hover:scale-150 duration-300">
        } @else {
        <div class="bg-red-100 rounded-2xl p-4 text-red-500 flex flex-col items-center max-w-96 text-wrap text-center">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="48" height="48" color="#ef4444"
            fill="none">
            <path
              d="M4 11.0004L4 14.5446C4 17.7896 4 19.4121 4.88607 20.5111C5.06508 20.7331 5.26731 20.9354 5.48933 21.1144C6.58831 22.0004 8.21082 22.0004 11.4558 22.0004C12.1614 22.0004 12.5141 22.0004 12.8372 21.8864C12.9044 21.8627 12.9702 21.8354 13.0345 21.8047C13.3436 21.6569 13.593 21.4074 14.0919 20.9085L18.8284 16.172C19.4065 15.5939 19.6955 15.3049 19.8478 14.9374C20 14.5698 20 14.1611 20 13.3436V10.0004C20 6.22919 20 4.34358 18.8284 3.172C17.7693 2.11284 16.1265 2.01122 13.0345 2.00146M13 21.5004V21.0004C13 18.172 13 16.7578 13.8787 15.8791C14.7574 15.0004 16.1716 15.0004 19 15.0004H19.5"
              stroke="#ef4444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            <path
              d="M9.97487 7.97438C10.6082 7.34101 11 6.46601 11 5.49951C11 3.56651 9.433 1.99951 7.5 1.99951C6.5335 1.99951 5.6585 2.39126 5.02513 3.02464M9.97487 7.97438C9.3415 8.60776 8.4665 8.99951 7.5 8.99951C5.567 8.99951 4 7.43251 4 5.49951C4 4.53301 4.39175 3.65801 5.02513 3.02464M9.97487 7.97438L5.02513 3.02464"
              stroke="#ef4444" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
          El estudiante aún no ha subido su evidencia de calificaciones.
        </div>
        }
      </div>
    </div>
  </mat-dialog-content>
  <mat-dialog-actions align="end">
    <button mat-dialog-close class="ja-btn ja-btn-secondary-sc">Close</button>
    <mat-paginator [length]="rows_with_evidence().length" [pageSize]="page_size" [pageIndex]="current_page"
      [hidePageSize]="true" (page)="onPageChange($event)" aria-label="Select page"></mat-paginator>
    <button class="ja-btn ja-btn-secondary" (click)="confirm_and_next(evidence)">Confirm and next</button>
  </mat-dialog-actions>
  }
</ng-template>


<!-- <div class="card bg-primary">
  <div class="card-header text-white" data-cy="grades-period">
    <span style="font-size: large"> Grades&nbsp;Statuses</span>
    <span style="margin-left: 2rem">
      Period:
      <select name="activePeriodSelector" data-cy="period-selector" [(ngModel)]="selectedGradesPeriodId"
        (change)="setSelectedGradesPeriodId($event.target.value)">
        @for (gradesProcessingPeriod of gradesProcessingPeriods; track gradesProcessingPeriod) {
        <option [value]="gradesProcessingPeriod.id">{{gradesProcessingPeriod.descriptor}}</option>
        }
      </select>
    </span>
    <label for="startDateIndicator">Grade Entry&nbsp;Start:</label>
    <input type="text" id="startDateIndicator" [value]="entryStartDate" readonly />
    <label for="endDateIndicator">Due&nbsp;Date:</label>
    <input type="text" id="endDateIndicator" [value]="entryEndDate" readonly />
  </div>
  <div class="card-body bg-white">
    @if (errorMessage) {
    <span class="alert alert-danger">{{ errorMessage }}</span>
    }
    @if (successMessage) {
    <span class="alert alert-success">{{ successMessage }}</span>
    }

    <div>
      @switch (isLoading) {
      @case (true) {
      <div class="text-center col-md-4 col-md-offset-4">
        <app-loading-container> </app-loading-container>
      </div>
      }
      @case (false) {
      <div>
        @if (gradesGivenEntryDTOs.length === 0) {
        <div class="text-center">
          [No Grades data found for this period]. Please select a different period.
        </div>
        }
        @if (gradesGivenEntryDTOs.length > 0) {
        <table class="table-sm table-striped">
          <thead>
            <tr>
              <th></th>
              <th></th>
              <th app-sortable-column="studentName" sort-direction="asc" (onSortColumn)="onSortColumn($event)">
                Student
              </th>
              <th app-sortable-column="gradesTurnedInDate" (onSortColumn)="onSortColumn($event)">Entered <br />Date</th>
              <th app-sortable-column="imageSubmittedDate" (onSortColumn)="onSortColumn($event)">Uploaded <br />Date
              </th>
              <th>View<br />Image</th>
              <th app-sortable-column="gradePointAvg" (onSortColumn)="onSortColumn($event)">GPA</th>
              <th app-sortable-column="confirmedDate" (onSortColumn)="onSortColumn($event)">Confirmed <br />Date</th>
              <th app-sortable-column="gradesTurnedInStatus" (onSortColumn)="onSortColumn($event)">Turned-In<br />Status
              </th>
              <th app-sortable-column="gradePointAvgStatus" (onSortColumn)="onSortColumn($event)">GPA<br />Status</th>
            </tr>
          </thead>
          <tbody>
            @for (entry of gradesGivenEntryDTOs; track entry; let i = $index) {
            <tr>
              <td>
                {{ i + 1 }}
              </td>
              <td (click)="gotoStudent(entry.studentGUId, entry.studentName)" class="link">
                Profile
              </td>
              <td (click)="editGradeEntryDetails(entry.studentGUId, entry.studentName)" class="link">
                {{ entry.studentName }}
              </td>
              <td>
                {{ entry.gradesTurnedInDate | truncateDate }}
              </td>
              <td>
                {{ entry.imageSubmittedDate | truncateDate }}
              </td>
              <td class="link">
                <div [hidden]="isViewLinkHidden(entry.imageSubmittedDate)">
                  <a href="{{staticUrlPrefix}}StudentGradesReports/{{entry.academicTermId}}/{{entry.studentGUId | uppercase }}.png"
                    target="_blank">{{entry.studentGUId | trimGuid | uppercase }}</a>
                </div>
              </td>
              <td>
                {{ entry.gradePointAvg }}
              </td>
              <td>
                {{ entry.confirmedDate | truncateDate }}
              </td>
              <td>
                {{ entry.gradesTurnedInStatus }}
              </td>
              <td>
                {{ entry.gradePointAvgStatus }}
              </td>
            </tr>
            }
          </tbody>
        </table>
        }
      </div>
      }
      }
    </div>
  </div>
</div> -->